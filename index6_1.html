<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AR Bubble Pop</title>

<script type="module"
  src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
</script>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
  }

.bubble {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  animation: float 2s infinite ease-in-out;
  cursor: pointer;
}

.blue { background: radial-gradient(circle, #9cf, #38f); }
.green { background: radial-gradient(circle, #9f9, #2c7); }
.red { background: radial-gradient(circle, #f99, #c33); }

.pop {
  animation: pop 0.3s forwards;
}

@keyframes pop {
  to {
    transform: scale(2);
    opacity: 0;
  }
}


  @keyframes float {
    0% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
    100% { transform: translateY(0); }
  }
</style>
</head>

<body>
<audio id="popSound"></audio>
<audio id="badSound"></audio>


<model-viewer
  id="viewer"
  src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
  camera-controls
  auto-rotate
  style="width:100vw;height:100vh;"
>

  <div
    class="bubble blue"
    slot="hotspot-1"
    data-position="0m 1.2m 0.3m"
    data-normal="0m 1m 0m"
    data-score="10">
  </div>

  <div
    class="bubble red"
    slot="hotspot-2"
    data-position="0.5m 1.4m 0.2m"
    data-normal="0m 1m 0m"
    data-score="-5">
  </div>

  <div
    class="bubble green"
    slot="hotspot-3"
    data-position="-0.5m 1.3m 0.2m"
    data-normal="0m 1m 0m"
    data-score="20">
  </div>

</model-viewer>

<script>
let audioUnlocked = false;

function unlockAudio() {
  if (audioUnlocked) return;

  popSound.play().then(() => {
    popSound.pause();
    popSound.currentTime = 0;
  }).catch(() => {});

  badSound.play().then(() => {
    badSound.pause();
    badSound.currentTime = 0;
  }).catch(() => {});

  audioUnlocked = true;
}

document.body.addEventListener("click", unlockAudio, { once: true });
</script>

<script>

let score = 0;

const popSound = document.getElementById("popSound");
const badSound = document.getElementById("badSound");

// Set sources AFTER user interaction (Storyline-safe)
function playSound(type) {
  let audio = type === "good" ? popSound : badSound;

  audio.src =
    type === "good"
      ? "https://assets.mixkit.co/sfx/preview/mixkit-bubble-pop-up-alert-notification-2357.mp3"
      : "https://assets.mixkit.co/sfx/preview/mixkit-arcade-retro-game-over-213.mp3";

  audio.currentTime = 0;
  audio.play().catch(err => console.log("Audio blocked:", err));
}

document.querySelectorAll(".bubble").forEach(bubble => {
  bubble.addEventListener("click", () => {
    const value = parseInt(bubble.dataset.score);

    score += value;
    bubble.classList.add("pop");

    if (value > 0) playSound("good");
    else playSound("bad");

    // ðŸ”´ SEND SCORE TO STORYLINE
    parent.postMessage(
      { type: "SCORE_UPDATE", value: score },
      "*"
    );

    console.log("Bubble:", value, "Total:", score);
  });
});
</script>


</body>
</html>
