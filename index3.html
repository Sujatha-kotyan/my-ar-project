<!DOCTYPE html>
<html>
<head>
  <title>Chapter 8 â€“ Model Control</title>

  <script type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <style>
    body { margin: 0; background: #111; }
    model-viewer {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>

<body>

<model-viewer
  id="viewer"
  src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
  camera-controls
  autoplay>
</model-viewer>

<script>
const viewer = document.getElementById("viewer");
let danceInterval = null;

// Wait for model
viewer.addEventListener("load", () => {
  console.log("âœ… Model loaded");
});

// Message from Storyline
window.addEventListener("message", (event) => {
  console.log("ðŸ“© Received:", event.data);

  if (!viewer.loaded) return;

  // stop previous effects
  clearInterval(danceInterval);
  viewer.autoRotate = false;

  switch (event.data) {

    // RESET
    case 1:
      viewer.cameraOrbit = "0deg 75deg 2.5m";
      break;

    // JUMP (camera bounce)
    case 2:
      viewer.cameraOrbit = "0deg 60deg 2.2m";
      setTimeout(() => {
        viewer.cameraOrbit = "0deg 75deg 2.5m";
      }, 300);
      break;

    // WAVE (small shake)
    case 3:
      viewer.cameraOrbit = "15deg 75deg 2.5m";
      setTimeout(() => {
        viewer.cameraOrbit = "-15deg 75deg 2.5m";
      }, 200);
      setTimeout(() => {
        viewer.cameraOrbit = "0deg 75deg 2.5m";
      }, 400);
      break;

    // DANCE (spin)
    case 4:
      viewer.autoRotate = true;
      viewer.autoRotateDelay = 0;
      viewer.rotationPerSecond = "180deg";
      break;
  }
});
</script>

</body>
</html>
