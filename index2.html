<!DOCTYPE html>
<html>
<head>
  <title>Chapter 8 â€“ Model Control</title>
  <script type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <style>
    body { margin: 0; background: #111; }
    model-viewer {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>

<body>

<model-viewer
  id="viewer"
  src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
  camera-controls
  auto-rotate
  exposure="1"
  shadow-intensity="1">
</model-viewer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const viewer = document.getElementById("viewer");

  if (!viewer) {
    console.error("âŒ model-viewer not found");
    return;
  }

  console.log("âœ… model-viewer found");

  viewer.addEventListener("load", () => {
    console.log("âœ… Model fully loaded");
  });

  function randomColor() {
    const material = viewer.model.materials[0];
    material.pbrMetallicRoughness.setBaseColorFactor([
      Math.random(),
      Math.random(),
      Math.random(),
      1
    ]);
  }

  window.addEventListener("message", (event) => {
    console.log("ðŸ“© Received step:", event.data);

    switch (event.data) {
      case 1:
        viewer.setAttribute("camera-orbit", "45deg 75deg 6m");
        viewer.setAttribute("interpolation-decay","200");
        break;

      case 2:
        viewer.autoRotate = false;
        break;

      case 3:
        viewer.cameraOrbit = "45deg 75deg 2.5m";
        break;

      case 4:
        randomColor();
        break;
    }
  });
});
</script>


</body>
</html>
