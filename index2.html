<!DOCTYPE html>
<html>
<head>
  <title>Chapter 8 â€“ Model Control</title>
  <script type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <style>
    body { margin: 0; background: #111; }
    model-viewer {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>

<body>

<model-viewer
  id="model"
  src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
  camera-controls
  auto-rotate
  exposure="1"
  shadow-intensity="1">
</model-viewer>

<script>
  const model = document.getElementById("model");
  let ready = false;

  model.addEventListener("load", () => {
    ready = true;
    console.log("âœ… Model loaded");
  });

  window.addEventListener("message", (event) => {
    console.log("ðŸ“© Received:", event.data);
    if (!ready) return;

    model.removeAttribute("auto-rotate");

    if (event.data === 1) {
      model.cameraOrbit = "0deg 75deg 2.5m";
    }

    if (event.data === 2) {
      model.cameraOrbit = "90deg 75deg 2.5m";
    }

    if (event.data === 3) {
      model.model.materials.forEach(mat => {
        if (mat.pbrMetallicRoughness) {
          mat.pbrMetallicRoughness.setBaseColorFactor([
            Math.random(),
            Math.random(),
            Math.random(),
            1
          ]);
        }
      });
    }
  });
</script>


</body>
</html>
