<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AR Bubble Shooter â€“ Stable Base</title>

<script type="module"
  src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
</script>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
  }

  model-viewer {
    position: fixed;
    inset: 0;
    z-index: 0;
  }

  .bubble {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    position: absolute;
    z-index: 10;
  }

  .blue  { background: radial-gradient(circle, #9cf, #38f); }
  .red   { background: radial-gradient(circle, #f99, #c33); }
  .green { background: radial-gradient(circle, #9f9, #2c7); }

</style>
</head>

<body>

<!-- 3D Background -->
<model-viewer
  src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
  camera-controls
  auto-rotate
  style="width:100vw;height:100vh;">
</model-viewer>

<!-- Shooter (fixed) -->
<div id="shooter" class="bubble blue"></div>

<script>
/* =====================
   CONFIG
===================== */
const BUBBLE_SIZE = 36;
const GRID_TOP = 80;
const COLS = 8;
const CELL = window.innerWidth / COLS;

const colors = ["blue", "red", "green"];

/* =====================
   SHOOTER SETUP
===================== */
const shooter = document.getElementById("shooter");

function placeShooter() {
  shooter.style.left = (window.innerWidth / 2 - BUBBLE_SIZE / 2) + "px";
  shooter.style.top = (window.innerHeight - 60) + "px";
}
placeShooter();

/* =====================
   SHOOT ACTION
===================== */
shooter.addEventListener("click", shootBubble);

function shootBubble() {

  const bubble = document.createElement("div");
  bubble.classList.add("bubble");

  const color = colors[Math.floor(Math.random() * colors.length)];
  bubble.classList.add(color);
  bubble.dataset.color = color;

  document.body.appendChild(bubble);

  let x = shooter.offsetLeft;
  let y = shooter.offsetTop;

  bubble.style.left = x + "px";
  bubble.style.top = y + "px";

  function move() {
    y -= 6;
    bubble.style.top = y + "px";

    // Reach top â†’ lock bubble
    if (y <= GRID_TOP) {
      snapToGrid(bubble, x);
      return;
    }

    requestAnimationFrame(move);
  }

  move();
}

/* =====================
   GRID SNAP
===================== */
function snapToGrid(bubble, x) {
  const col = Math.floor(x / CELL);
  const snapX = col * CELL + CELL / 2 - BUBBLE_SIZE / 2;

  bubble.style.left = snapX + "px";
  bubble.style.top = GRID_TOP + "px";

  console.log("ðŸŸ¢ Bubble locked:", bubble.dataset.color);
}
</script>

</body>
</html>
